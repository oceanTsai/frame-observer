
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Function Test</title>
</head>
<body>
  <script src="../dist/frameObserver.js"></script>
  <!--<script src="../src/js/buildDeferred.js"></script> 
  <script src="../src/js/config.js"></script>
  <script src="../src/js/guid.js"></script>
  <script src="../src/js/util.js"></script>
  <script src="../src/js/urlUtils.js"></script>
  <script src="../src/js/EventObserver.js"></script>
  <script src="../src/js/StateManager.js"></script>
  <script src="../src/js/builder.js"></script>
  <script src="../src/js/processor/MethodProcessor.js"></script>
  <script src="../src/js/processor/RegisterMsgProcessor.js"></script>
  <script src="../src/js/processor/UnregisterMsgProcessor.js"></script>
  <script src="../src/js/processor/EventMsgProcessor.js"></script>
  <script src="../src/js/processor/StateProcessor.js"></script>
  <script src="../src/js/frameObserver.js"></script>-->
  <script>

    describe('Ready Test', function () {
     
      it('should has a callback when iframe is ready', function(done) {
        this.timeout(10000);
        var iframe = document.createElement('iframe');

        iframe.onload = function() {

          describe('Listen idle event from iframe', function() {
            this.timeout(10000);

            it('should recv a idle event', (idleDone)=>{
              frameObserver.on(iframe, 'idle', (resp, ms)=> {
                expect(typeof ms).to.equal('number');
                idleDone();
              });
            })
          });

          frameObserver
          .readyState( iframe, 'ready' )
          .then(function(){

             describe('Call iframe "add" method', function() {
               this.timeout(10000);
               let valueA = 5;
               let valueB = 6;

               it(`should get ${valueA} + ${valueB} = ${valueA + valueB}`, (addDone)=> {
                 frameObserver.callMethod(iframe, 'add', 5, 6).then((resp)=> {
                   expect(resp[0].result[0]).to.equal(valueA + valueB);
                   addDone();
                 });
               });
             });

             frameObserver.callMethod(iframe, 'initIdle');

             done();
          });
        
        };
        iframe.src = '/base/test/iframe.html';
        document.body.append(iframe);
      });
    });
  </script>
</body>
</html>

